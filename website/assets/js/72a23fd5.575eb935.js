"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3035],{1413:(e,a,i)=>{i.r(a),i.d(a,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"faq","title":"FAQ","description":"What kind of vulnerabilities can Copa patch?","source":"@site/versioned_docs/version-v0.9.x/faq.md","sourceDirName":".","slug":"/faq","permalink":"/copacetic/website/faq","draft":false,"unlisted":false,"tags":[],"version":"v0.9.x","frontMatter":{"title":"FAQ"},"sidebar":"sidebar","previous":{"title":"Troubleshooting","permalink":"/copacetic/website/troubleshooting"},"next":{"title":"Github Action","permalink":"/copacetic/website/github-action"}}');var t=i(4848),s=i(8453);const o={title:"FAQ"},r=void 0,c={},l=[{value:"What kind of vulnerabilities can Copa patch?",id:"what-kind-of-vulnerabilities-can-copa-patch",level:2},{value:"What kind of vulnerabilities can Copa not patch?",id:"what-kind-of-vulnerabilities-can-copa-not-patch",level:2},{value:"My disk space is being filled up after using Copa. How can I fix this?",id:"my-disk-space-is-being-filled-up-after-using-copa-how-can-i-fix-this",level:2},{value:"How does Copa determine what tooling image to use?",id:"how-does-copa-determine-what-tooling-image-to-use",level:2},{value:"DPKG",id:"dpkg",level:3},{value:"Debian",id:"debian",level:4},{value:"Ubuntu",id:"ubuntu",level:4},{value:"RPM",id:"rpm",level:3},{value:"Azure Linux 3.0+",id:"azure-linux-30",level:4},{value:"CBL-Mariner (Azure Linux 1 and 2), CentOS, Oracle Linux, Rocky Linux, Alma Linux, and Amazon Linux",id:"cbl-mariner-azure-linux-1-and-2-centos-oracle-linux-rocky-linux-alma-linux-and-amazon-linux",level:4},{value:"APK (Alpine)",id:"apk-alpine",level:3},{value:"After Copa patched the image, why does the scanner still show patched OS package vulnerabilities?",id:"after-copa-patched-the-image-why-does-the-scanner-still-show-patched-os-package-vulnerabilities",level:2},{value:"Can I replace the package repositories in the image with my own?",id:"can-i-replace-the-package-repositories-in-the-image-with-my-own",level:2},{value:"I am getting <code>downloaded package ... version ... lower than required ... for update</code> error when trying to patch an image. What does this mean?",id:"i-am-getting-downloaded-package--version--lower-than-required--for-update-error-when-trying-to-patch-an-image-what-does-this-mean",level:2},{value:"Can I use Dependabot with Copa patched images?",id:"can-i-use-dependabot-with-copa-patched-images",level:2},{value:"Does Copa cause a buildup of patched layers on each patch?",id:"does-copa-cause-a-buildup-of-patched-layers-on-each-patch",level:2}];function d(e){const a={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h2,{id:"what-kind-of-vulnerabilities-can-copa-patch",children:"What kind of vulnerabilities can Copa patch?"}),"\n",(0,t.jsxs)(a.p,{children:['Copa is capable of patching "OS level" vulnerabilities. This includes packages (like ',(0,t.jsx)(a.code,{children:"openssl"}),") in the image that are managed by a package manager such as ",(0,t.jsx)(a.code,{children:"apt-get"})," or ",(0,t.jsx)(a.code,{children:"yum"}),'. Copa is not currently capable of patching vulnerabilities at the "application level" such as Python packages or Go modules (see ',(0,t.jsx)(a.a,{href:"#what-kind-of-vulnerabilities-can-copa-not-patch",children:"below"})," for more details)."]}),"\n",(0,t.jsx)(a.h2,{id:"what-kind-of-vulnerabilities-can-copa-not-patch",children:"What kind of vulnerabilities can Copa not patch?"}),"\n",(0,t.jsxs)(a.p,{children:['Copa is not capable of patching vulnerabilities for compiled languages, like Go, at the "application level", for instance, Go modules. If your application uses a vulnerable version of the ',(0,t.jsx)(a.code,{children:"golang.org/x/net"})," module, Copa will be unable to patch it. This is because Copa doesn't have access to the application's source code or the knowledge of how to build it, such as compiler flags, preventing it from patching vulnerabilities at the application level."]}),"\n",(0,t.jsxs)(a.p,{children:["To patch vulnerabilities for applications, you can package these applications and consume them from package repositories, like ",(0,t.jsx)(a.code,{children:"http://archive.ubuntu.com/ubuntu/"})," for Ubuntu, and ensure Trivy can scan and report vulnerabilities for these packages. This way, Copa can patch the applications as a whole, though it cannot patch specific modules within the applications."]}),"\n",(0,t.jsx)(a.h2,{id:"my-disk-space-is-being-filled-up-after-using-copa-how-can-i-fix-this",children:"My disk space is being filled up after using Copa. How can I fix this?"}),"\n",(0,t.jsxs)(a.p,{children:["If you find that your storage is rapidly being taken up after working with Copa, run ",(0,t.jsx)(a.code,{children:"docker system prune"}),". This will prune all unused images, containers and caches."]}),"\n",(0,t.jsx)(a.h2,{id:"how-does-copa-determine-what-tooling-image-to-use",children:"How does Copa determine what tooling image to use?"}),"\n",(0,t.jsx)(a.p,{children:"All images being passed into Copa have their versioning data carefully extracted and stripped so that an appropriate tooling image can be obtained from a container repository."}),"\n",(0,t.jsx)(a.h3,{id:"dpkg",children:"DPKG"}),"\n",(0,t.jsx)(a.h4,{id:"debian",children:"Debian"}),"\n",(0,t.jsxs)(a.p,{children:["All debian-based images have their ",(0,t.jsx)(a.code,{children:"minor.patch"})," versioning stripped and ",(0,t.jsx)(a.code,{children:"-slim"})," appended. e.g. if ",(0,t.jsx)(a.code,{children:"nginx:1.21.6"})," is being patched, ",(0,t.jsx)(a.code,{children:"debian:11-slim"})," is used as the tooling image."]}),"\n",(0,t.jsx)(a.h4,{id:"ubuntu",children:"Ubuntu"}),"\n",(0,t.jsxs)(a.p,{children:["All Ubuntu-based images use the same versioning that was passed in. e.g. if ",(0,t.jsx)(a.code,{children:"tomcat:10.1.17-jre17-temurin-jammy"})," is passed in, ",(0,t.jsx)(a.code,{children:"ubuntu:22.04"})," will be used for the tooling image."]}),"\n",(0,t.jsxs)(a.p,{children:["There is one caveat for Ubuntu-based images. If an Ubuntu-based image is being patched without a Trivy scan, Copa is unable to parse a scan for versioning information. In these scenarios, Copa will fallback to ",(0,t.jsx)(a.code,{children:"debian:stable-slim"})," as the tooling image."]}),"\n",(0,t.jsx)(a.h3,{id:"rpm",children:"RPM"}),"\n",(0,t.jsx)(a.h4,{id:"azure-linux-30",children:"Azure Linux 3.0+"}),"\n",(0,t.jsxs)(a.p,{children:["Azure Linux based images will use ",(0,t.jsx)(a.code,{children:"mcr.microsoft.com/azurelinux/base/core"})," with the same version as the image being patched."]}),"\n",(0,t.jsx)(a.h4,{id:"cbl-mariner-azure-linux-1-and-2-centos-oracle-linux-rocky-linux-alma-linux-and-amazon-linux",children:"CBL-Mariner (Azure Linux 1 and 2), CentOS, Oracle Linux, Rocky Linux, Alma Linux, and Amazon Linux"}),"\n",(0,t.jsxs)(a.p,{children:["These RPM-based distros will use ",(0,t.jsx)(a.code,{children:"mcr.microsoft.com/cbl-mariner/base/core:2.0"})]}),"\n",(0,t.jsx)(a.h3,{id:"apk-alpine",children:"APK (Alpine)"}),"\n",(0,t.jsx)(a.p,{children:"APK-based images never use a tooling image, as Copa does not patch distroless alpine images."}),"\n",(0,t.jsx)(a.h2,{id:"after-copa-patched-the-image-why-does-the-scanner-still-show-patched-os-package-vulnerabilities",children:"After Copa patched the image, why does the scanner still show patched OS package vulnerabilities?"}),"\n",(0,t.jsx)(a.p,{children:"After scanning the patched image, if you\u2019re still seeing vulnerabilities that have already been addressed in the patch layer, it could be due to the scanner reporting issues on each individual layer. Please reach out to your scanner vendor for assistance in resolving this."}),"\n",(0,t.jsx)(a.h2,{id:"can-i-replace-the-package-repositories-in-the-image-with-my-own",children:"Can I replace the package repositories in the image with my own?"}),"\n",(0,t.jsx)(a.admonition,{type:"caution",children:(0,t.jsx)(a.p,{children:"Experimental: This feature might change without preserving backwards compatibility."})}),"\n",(0,t.jsxs)(a.p,{children:["Copa does not support replacing the repositories in the package managers with alternatives. Images must already use the intended package repositories. For example, for debian, updating ",(0,t.jsx)(a.code,{children:"/etc/apt/sources.list"})," from ",(0,t.jsx)(a.code,{children:"http://archive.ubuntu.com/ubuntu/"})," to a mirror, such as ",(0,t.jsx)(a.code,{children:"https://mirrors.wikimedia.org/ubuntu/"}),"."]}),"\n",(0,t.jsxs)(a.p,{children:["If you need the tooling image to use a different package repository, you can create a source policy to define a replacement image and/or pin to a digest. For example, the following source policy replaces ",(0,t.jsx)(a.code,{children:"docker.io/library/debian:11-slim"})," image with ",(0,t.jsx)(a.code,{children:"foo.io/bar/baz:latest@sha256:42d3e6bc186572245aded5a0be381012adba6d89355fa9486dd81b0c634695b5"}),":"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-shell",children:'cat <<EOF > source-policy.json\n{\n    "rules": [\n        {\n            "action": "CONVERT",\n            "selector": {\n                "identifier": "docker-image://docker.io/library/debian:11-slim"\n            },\n            "updates": {\n                "identifier": "docker-image://foo.io/bar/baz:latest@sha256:42d3e6bc186572245aded5a0be381012adba6d89355fa9486dd81b0c634695b5"\n            }\n        }\n    ]\n}\nEOF\n\nexport EXPERIMENTAL_BUILDKIT_SOURCE_POLICY=source-policy.json\n'})}),"\n",(0,t.jsxs)(a.blockquote,{children:["\n",(0,t.jsxs)(a.p,{children:["The tooling image for Debian-based images can be ",(0,t.jsx)(a.code,{children:"docker.io/library/debian:11-slim"})," or ",(0,t.jsx)(a.code,{children:"docker.io/library/debian:12-slim"})," depending on the target image version. RPM-based repos use ",(0,t.jsx)(a.code,{children:"mcr.microsoft.com/cbl-mariner/base/core:2.0"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(a.p,{children:["For more information on source policies, see ",(0,t.jsx)(a.a,{href:"https://docs.docker.com/build/building/env-vars/#experimental_buildkit_source_policy",children:"Buildkit Source Policies"}),"."]}),"\n",(0,t.jsxs)(a.h2,{id:"i-am-getting-downloaded-package--version--lower-than-required--for-update-error-when-trying-to-patch-an-image-what-does-this-mean",children:["I am getting ",(0,t.jsx)(a.code,{children:"downloaded package ... version ... lower than required ... for update"})," error when trying to patch an image. What does this mean?"]}),"\n",(0,t.jsx)(a.p,{children:"This error means that the package manager is trying to install a version of the package that is lower than the version that was required from the scanner report. This can happen for a few reasons:"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Package repositories are not updated to the latest version of the package. For example, sometimes there is a lag between when a CVE is detected by Trivy using Red Hat vulnerability database and when it is available in the package repositories for CentOS."}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Scanner reports are not up to date. Make sure to run the scanner with the latest vulnerability database. If you are using Trivy, it is recommended to pull the latest version of the Trivy DB, and not rely on cached or stale versions."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(a.p,{children:["To verify the package version discrepancies, you can compare the package version provided by the package repositories and the scanner reports. Follow the Trivy documentation on ",(0,t.jsx)(a.a,{href:"https://aquasecurity.github.io/trivy/dev/community/contribute/discussion/#false-detection",children:"how to find the security advisory data sources"}),", and then compare the package version in the scanner report with the applicable security advisory, and applicable package repository."]}),"\n",(0,t.jsx)(a.p,{children:"If you are continuing to see this and the package repositories and vulnerability databases are not updated, you can either:"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsxs)(a.p,{children:["use ",(0,t.jsx)(a.code,{children:"--ignore-errors"})," flag or ",(0,t.jsx)(a.a,{href:"/copacetic/website/troubleshooting#filtering-vulnerabilities",children:"filter the applicable vulnerability in the scanner"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"update all packages without any scanner reports. This can be done by not providing a scanner report to copa, and copa will update all packages to the latest version available in the package repositories."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(a.h2,{id:"can-i-use-dependabot-with-copa-patched-images",children:"Can I use Dependabot with Copa patched images?"}),"\n",(0,t.jsxs)(a.p,{children:["Yes, see ",(0,t.jsx)(a.a,{href:"/copacetic/website/best-practices#dependabot",children:"best practices"})," to learn more about using Dependabot with Copa patched images."]}),"\n",(0,t.jsx)(a.h2,{id:"does-copa-cause-a-buildup-of-patched-layers-on-each-patch",children:"Does Copa cause a buildup of patched layers on each patch?"}),"\n",(0,t.jsx)(a.p,{children:"No. To prevent a buildup of layers, Copa discards the previous patch layer with each new patch. Each subsequent patch removes the earlier patch layer and creates a new one, which includes all patches applied since the original base image Copa started with. Essentially, Copa is creating a new layer with the latest patch, based on the base/original image. This new layer is a combination (or squash) of both the previous updates and the new updates requested. Discarding the patch layer also reduces the size of the resulting patched images in the future."})]})}function h(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,a,i)=>{i.d(a,{R:()=>o,x:()=>r});var n=i(6540);const t={},s=n.createContext(t);function o(e){const a=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(s.Provider,{value:a},e.children)}}}]);